---
layout: default
title: "Menu Prototyping"
---

<div>
  <p tabindex="0">
    This is a prototype for a settings menu that changes the Olli description text. For each of the four
    levels of the graph, you can choose which pieces of information will be included. 'High' and 'low'
    verbosity provide two basic options; you can also use the 'custom' setting to make your own preset. 
    Within the custom menu, you can select individual items as well as reorder them using command-up and 
    command-down. To switch between the menu and the Olli description, use accesskeys m and d or ctrl-m and ctrl-d.

    To switch each of the four verbosity levels between high and low, you can simply type f low or f high, using f for facet,
    a for axis, s for section, and d for datapoint. While in the description, you can also type the name of any individual token
    (e.g. 'index' or 'type') to have it added to the part of the description you're currently in.
  </p>

  <fieldset id="settings" tabindex="0" accesskey="s">
    <legend>Settings Menu</legend>

    <!-- Control menu is automatically generated -->

  </fieldset>

  <img src="img/multiSeriesLineChart.JPG">

  <ul id="description"></ul>

  <p>((aria-live speaking hack))</p>
  <div id="speak" aria-live="assertive"></div>
</div>

<style>
  input[type='number']{
    width: 3em;
  } 
  
  #settings select, input[type=text] {
    margin: 5px;
  }

  .no-list-style {
    list-style: none;
  }

</style>

<script>
  const TOKEN_TYPES = [
    'index',
    'type',
    'size',
    'relative',
    'data',
    'aggregate',
    'parent',
    'name',
    'children'
  ];

  const TOKEN_TEXT = {
    'index': 'Index ("1 of 5")',
    'type': 'Item type ("line", "temporal")',
    'size': 'Size ("10 values")',
    'relative': 'Quartile',
    'data': 'Data values',
    'aggregate': 'Min, max, and average',
    'parent': 'View name',
    'name': 'Item name',
    'children': 'Child names',
  }

  const controls = {
    'root': {
        'tokens': ['name']
    },
    'facet': {
      'tokens': ['index', 'type', 'name', 'children'],
      // each list in options must be a subset of tokens; lists are ordered
      'options': {
        'high': ['index', 'type', 'name', 'children'],
        'low': ['type', 'name', 'children'],
      }
    },
    'axis': {
      'tokens': ['name', 'type', 'data', 'size', 'parent', 'aggregate'],
      'options': {
        'high': ['name', 'type', 'data', 'size', 'parent', 'aggregate'],
        'low': ['name', 'type', 'data'],
      }
    },
    'section': {
      'tokens': ['data', 'index', 'size', 'parent'],
      'options': {
        'high': ['data', 'index', 'size', 'parent'],
        'low': ['data', 'size'],
      }
    },
    'datapoint': {
      'tokens': ['data', 'parent'],
      'options': {
        'high': ['data', 'parent'],
        'low': ['data']
      }
    }
  }

  for (let control of Object.keys(controls)) {
    // create the container when displaying for the first time
    const container = document.createElement('div');
    container.id = `${control}-menu`
    document.getElementById('settings').append(container);

    vMenu = makeVerbosityMenu(control);
    
    if (vMenu) {
      // empty out the container before adding new items
      const menu = document.getElementById(`${control}-menu`);
      menu.innerHTML = '';
      menu.append(vMenu);

      cMenu = makeCustomMenu(control);
      cMenu.setAttribute('style', 'display: none');
      cMenu.setAttribute('aria-hidden', 'true');
      menu.append(cMenu);
    }
  }

  function updateVerbosityDropdown(control) {
    oldMenu = document.getElementById(`${control}-verbosity-container`);
    oldMenu.replaceWith(makeVerbosityMenu(control));
  }

  function makeVerbosityMenu(control) {
    const options = controls[control]['options'];
    if (!options) { return null; }

    const dropdown = document.createElement('select');
    // dropdown.name = control TODO Why was this here?
    dropdown.id = `${control}-verbosity`
    dropdown.setAttribute('onchange', 'updateDescription(this)');

    for (let option of Object.keys(options)) {
      let opt = document.createElement('option');
      opt.innerText = option;
      opt.value = option;
      dropdown.appendChild(opt);
    }
    custom = document.createElement('option');
    custom.innerText = 'custom';
    custom.value = 'custom';
    dropdown.appendChild(custom)

    const label = document.createElement('label');
    label.setAttribute('for', `${control}-verbosity`);
    label.innerText = titleCase(`${control} verbosity:`);

    const info = document.createElement('span');
    info.setAttribute('tabindex', '0')
    info.innerText = `Description: ${controls[control]['options'][Object.keys(options)[0]].join(', ')}`;

    const container = document.createElement('div');
    container.id = `${control}-verbosity-container`;
    container.appendChild(label);
    container.appendChild(dropdown);
    container.append(info);

    return container;
  }

  function makeCustomMenu(control) {
    const tokens = controls[control]['tokens'];
    const container = document.createElement('div');
    container.id = `${control}-preset`;

    const checkboxContainer = document.createElement('div');
    checkboxContainer.id = `${control}-preset-options`;

    for (let token of tokens) {
      const input = document.createElement('input');
      input.type = 'checkbox';
      input.id = `${control}-${token}`;

      const label = document.createElement('label');
      label.setAttribute('for', `${control}-${token}`);
      label.innerText = TOKEN_TEXT[token];

      const div = document.createElement('div');
      div.appendChild(input);
      div.appendChild(label);
      checkboxContainer.append(div);
    }

    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.id = `${control}-preset-name`;

    const nameLabel = document.createElement('label');
    nameLabel.setAttribute('for', `${control}-preset-name`);
    nameLabel.innerText = 'Custom preset name';

    const saveButton = document.createElement('button');
    saveButton.innerText = 'Save';
    saveButton.setAttribute('onclick', `savePreset('${control}')`);

    container.append(checkboxContainer);
    container.appendChild(nameLabel);
    container.appendChild(nameInput);
    container.appendChild(saveButton);
    return container;
  }

  function updateDescription(dropdown) {
    control = dropdown.id.split('-')[0];

    if (dropdown.value === 'custom') {
      // Open the customization mennu
      customMenu = document.getElementById(`${control}-preset`);
      customMenu.setAttribute('style', 'display: block');
      customMenu.setAttribute('aria-hidden', 'false');
      dropdown.nextElementSibling.innerText = "Create a custom preset using the preset menu (next element)."
    } else {
      // Update the current description based on the new setting
      dropdown.nextElementSibling.innerText =
        `Description: ${controls[control]['options'][dropdown.value].join(', ')}`;
      displayRootDescription();
      // Turned off for now since changes now often don't affect last focused
      // speakLastFocused();
    }
  }

  function savePreset(control) {
    customMenu = document.getElementById(`${control}-preset`);
    customMenu.setAttribute('style', 'display: none');
    customMenu.setAttribute('aria-hidden', 'true');
    
    name = document.getElementById(`${control}-preset-name`).value;
    tokens = []

    for (tokenOption of document.getElementById(`${control}-preset-options`).children) {
      if (tokenOption.firstElementChild.checked) {  // checkbox
        tokens.push(tokenOption.lastElementChild.innerText)  // label name
      }
    }

    controls[control]['options'][name] = tokens;
    updateVerbosityDropdown(control);

    dropdown = document.getElementById(`${control}-verbosity`);
    dropdown.value = name;
    updateDescription(dropdown);
    dropdown.focus();
    dropdown.setAttribute('aria-active', true);
  }

  /***
   *  Event listeners for the menu
   ***/
  let lastActiveDescriptionId = "0"; // 0 is id of root node

  // Reordering event listener
  document.addEventListener('keydown', (e) => {
    if (e.metaKey && e.key === 'ArrowUp') {
      const thisCheckbox = document.activeElement;
      const thisDiv = thisCheckbox.parentNode;
      const previousDiv = thisDiv.previousElementSibling;
      if (previousDiv != null && previousDiv.nodeName !== "LEGEND") {
        // Change menu ordering
        // Note: don't want to call insertBefore(thisDiv, previousDiv)
        // because first parameter to insertBefore loses focus
        thisDiv.insertAdjacentElement('afterend', previousDiv);
        thisCheckbox.focus();
        thisCheckbox.setAttribute('aria-active', true);
      }
    } else if (e.metaKey && e.key === 'ArrowDown') {
      const thisCheckbox = document.activeElement;
      const thisDiv = thisCheckbox.parentNode;
      const nextDiv = thisDiv.nextElementSibling;
      if (nextDiv != null) {
        thisDiv.parentNode.insertBefore(nextDiv, thisDiv);
      }
    }
  })

  function changeAssociatedInputState(input) {
    document.getElementById(`${input.id}-input`).disabled = !input.checked;
  }

  function speakLastFocused() {
    srSpeak(document.getElementById(lastActiveDescriptionId).firstChild.innerText);
  }

  /***
   *  Data for the description 
   ***/


const tree = {
    type: "root",
    tokens: {name: "A faceted chart with 5 views."},
    children: [
      {
        type: "facet",
        tokens: {
          index: '1 of 5.',
          type: 'Line chart.',
          name: '"MSFT".',
          children: 'Axes "date" and "price".'
        },
        children: 
[{type: 'axis', tokens: {type: 'Temporal scale.', size: '6 grid sections.', data: 'Values from "Jan 1, 2000" to "Jan 1, 2010."', parent: '"MSFT".', name: 'X-axis titled "date".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '0 values.', data: 'Jan 1, 1998 to Jan 1, 2000.', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '24 values.', data: 'Jan 1, 2000 to Jan 1, 2002.', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [['39.81', 'Jan 1 2000'], ['36.35', 'Feb 1 2000'], ['43.22', 'Mar 1 2000'], ['28.37', 'Apr 1 2000'], ['25.45', 'May 1 2000'], ['32.54', 'Jun 1 2000'], ['28.4', 'Jul 1 2000'], ['28.4', 'Aug 1 2000'], ['24.53', 'Sep 1 2000'], ['28.02', 'Oct 1 2000'], ['23.34', 'Nov 1 2000'], ['17.65', 'Dec 1 2000'], ['24.84', 'Jan 1 2001'], ['24', 'Feb 1 2001'], ['22.25', 'Mar 1 2001'], ['27.56', 'Apr 1 2001'], ['28.14', 'May 1 2001'], ['29.7', 'Jun 1 2001'], ['26.93', 'Jul 1 2001'], ['23.21', 'Aug 1 2001'], ['20.82', 'Sep 1 2001'], ['23.65', 'Oct 1 2001'], ['26.12', 'Nov 1 2001'], ['26.95', 'Dec 1 2001']], parent: ['MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT']}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '24 values.', data: 'Jan 1, 2002 to Jan 1, 2004.', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [['25.92', 'Jan 1 2002'], ['23.73', 'Feb 1 2002'], ['24.53', 'Mar 1 2002'], ['21.26', 'Apr 1 2002'], ['20.71', 'May 1 2002'], ['22.25', 'Jun 1 2002'], ['19.52', 'Jul 1 2002'], ['19.97', 'Aug 1 2002'], ['17.79', 'Sep 1 2002'], ['21.75', 'Oct 1 2002'], ['23.46', 'Nov 1 2002'], ['21.03', 'Dec 1 2002'], ['19.31', 'Jan 1 2003'], ['19.34', 'Feb 1 2003'], ['19.76', 'Mar 1 2003'], ['20.87', 'Apr 1 2003'], ['20.09', 'May 1 2003'], ['20.93', 'Jun 1 2003'], ['21.56', 'Jul 1 2003'], ['21.65', 'Aug 1 2003'], ['22.69', 'Sep 1 2003'], ['21.45', 'Oct 1 2003'], ['21.1', 'Nov 1 2003'], ['22.46', 'Dec 1 2003']], parent: ['MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT']}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '24 values.', data: 'Jan 1, 2004 to Jan 1, 2006.', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [['22.69', 'Jan 1 2004'], ['21.77', 'Feb 1 2004'], ['20.46', 'Mar 1 2004'], ['21.45', 'Apr 1 2004'], ['21.53', 'May 1 2004'], ['23.44', 'Jun 1 2004'], ['23.38', 'Jul 1 2004'], ['22.47', 'Aug 1 2004'], ['22.76', 'Sep 1 2004'], ['23.02', 'Oct 1 2004'], ['24.6', 'Nov 1 2004'], ['24.52', 'Dec 1 2004'], ['24.11', 'Jan 1 2005'], ['23.15', 'Feb 1 2005'], ['22.24', 'Mar 1 2005'], ['23.28', 'Apr 1 2005'], ['23.82', 'May 1 2005'], ['22.93', 'Jun 1 2005'], ['23.64', 'Jul 1 2005'], ['25.35', 'Aug 1 2005'], ['23.83', 'Sep 1 2005'], ['23.8', 'Oct 1 2005'], ['25.71', 'Nov 1 2005'], ['24.29', 'Dec 1 2005']], parent: ['MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT']}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '24 values.', data: 'Jan 1, 2006 to Jan 1, 2008.', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [['26.14', 'Jan 1 2006'], ['25.04', 'Feb 1 2006'], ['25.36', 'Mar 1 2006'], ['22.5', 'Apr 1 2006'], ['21.19', 'May 1 2006'], ['21.8', 'Jun 1 2006'], ['22.51', 'Jul 1 2006'], ['24.13', 'Aug 1 2006'], ['25.68', 'Sep 1 2006'], ['26.96', 'Oct 1 2006'], ['27.66', 'Nov 1 2006'], ['28.13', 'Dec 1 2006'], ['29.07', 'Jan 1 2007'], ['26.63', 'Feb 1 2007'], ['26.35', 'Mar 1 2007'], ['28.3', 'Apr 1 2007'], ['29.11', 'May 1 2007'], ['27.95', 'Jun 1 2007'], ['27.5', 'Jul 1 2007'], ['27.34', 'Aug 1 2007'], ['28.04', 'Sep 1 2007'], ['35.03', 'Oct 1 2007'], ['32.09', 'Nov 1 2007'], ['34', 'Dec 1 2007']], parent: ['MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT']}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '24 values.', data: 'Jan 1, 2008 to Jan 1, 2010.', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [['31.13', 'Jan 1 2008'], ['26.07', 'Feb 1 2008'], ['27.21', 'Mar 1 2008'], ['27.34', 'Apr 1 2008'], ['27.25', 'May 1 2008'], ['26.47', 'Jun 1 2008'], ['24.75', 'Jul 1 2008'], ['26.36', 'Aug 1 2008'], ['25.78', 'Sep 1 2008'], ['21.57', 'Oct 1 2008'], ['19.66', 'Nov 1 2008'], ['18.91', 'Dec 1 2008'], ['16.63', 'Jan 1 2009'], ['15.81', 'Feb 1 2009'], ['17.99', 'Mar 1 2009'], ['19.84', 'Apr 1 2009'], ['20.59', 'May 1 2009'], ['23.42', 'Jun 1 2009'], ['23.18', 'Jul 1 2009'], ['24.43', 'Aug 1 2009'], ['25.49', 'Sep 1 2009'], ['27.48', 'Oct 1 2009'], ['29.27', 'Nov 1 2009'], ['30.34', 'Dec 1 2009']], parent: ['MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT']}, children: []}]}, {type: 'section', tokens: {index: '6 of 6.', size: '3 values.', data: 'Jan 1, 2010 to Jan 1, 2012.', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [['28.05', 'Jan 1 2010'], ['28.67', 'Feb 1 2010'], ['28.8', 'Mar 1 2010']], parent: ['MSFT', 'MSFT', 'MSFT']}, children: []}]}]}, {type: 'axis', tokens: {type: 'Quantitative scale.', size: '4 grid sections.', data: 'Values from "0" to "800".', 'aggregate': 'The average value is 24.74, the minimum is 15.81, and the maximum is 43.22.', parent: '"MSFT".', name: 'Y-axis titled "price".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '123 values.', data: '0 to 200', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [['39.81', 'Jan 1 2000'], ['36.35', 'Feb 1 2000'], ['43.22', 'Mar 1 2000'], ['28.37', 'Apr 1 2000'], ['25.45', 'May 1 2000'], ['32.54', 'Jun 1 2000'], ['28.4', 'Jul 1 2000'], ['28.4', 'Aug 1 2000'], ['24.53', 'Sep 1 2000'], ['28.02', 'Oct 1 2000'], ['23.34', 'Nov 1 2000'], ['17.65', 'Dec 1 2000'], ['24.84', 'Jan 1 2001'], ['24', 'Feb 1 2001'], ['22.25', 'Mar 1 2001'], ['27.56', 'Apr 1 2001'], ['28.14', 'May 1 2001'], ['29.7', 'Jun 1 2001'], ['26.93', 'Jul 1 2001'], ['23.21', 'Aug 1 2001'], ['20.82', 'Sep 1 2001'], ['23.65', 'Oct 1 2001'], ['26.12', 'Nov 1 2001'], ['26.95', 'Dec 1 2001'], ['25.92', 'Jan 1 2002'], ['23.73', 'Feb 1 2002'], ['24.53', 'Mar 1 2002'], ['21.26', 'Apr 1 2002'], ['20.71', 'May 1 2002'], ['22.25', 'Jun 1 2002'], ['19.52', 'Jul 1 2002'], ['19.97', 'Aug 1 2002'], ['17.79', 'Sep 1 2002'], ['21.75', 'Oct 1 2002'], ['23.46', 'Nov 1 2002'], ['21.03', 'Dec 1 2002'], ['19.31', 'Jan 1 2003'], ['19.34', 'Feb 1 2003'], ['19.76', 'Mar 1 2003'], ['20.87', 'Apr 1 2003'], ['20.09', 'May 1 2003'], ['20.93', 'Jun 1 2003'], ['21.56', 'Jul 1 2003'], ['21.65', 'Aug 1 2003'], ['22.69', 'Sep 1 2003'], ['21.45', 'Oct 1 2003'], ['21.1', 'Nov 1 2003'], ['22.46', 'Dec 1 2003'], ['22.69', 'Jan 1 2004'], ['21.77', 'Feb 1 2004'], ['20.46', 'Mar 1 2004'], ['21.45', 'Apr 1 2004'], ['21.53', 'May 1 2004'], ['23.44', 'Jun 1 2004'], ['23.38', 'Jul 1 2004'], ['22.47', 'Aug 1 2004'], ['22.76', 'Sep 1 2004'], ['23.02', 'Oct 1 2004'], ['24.6', 'Nov 1 2004'], ['24.52', 'Dec 1 2004'], ['24.11', 'Jan 1 2005'], ['23.15', 'Feb 1 2005'], ['22.24', 'Mar 1 2005'], ['23.28', 'Apr 1 2005'], ['23.82', 'May 1 2005'], ['22.93', 'Jun 1 2005'], ['23.64', 'Jul 1 2005'], ['25.35', 'Aug 1 2005'], ['23.83', 'Sep 1 2005'], ['23.8', 'Oct 1 2005'], ['25.71', 'Nov 1 2005'], ['24.29', 'Dec 1 2005'], ['26.14', 'Jan 1 2006'], ['25.04', 'Feb 1 2006'], ['25.36', 'Mar 1 2006'], ['22.5', 'Apr 1 2006'], ['21.19', 'May 1 2006'], ['21.8', 'Jun 1 2006'], ['22.51', 'Jul 1 2006'], ['24.13', 'Aug 1 2006'], ['25.68', 'Sep 1 2006'], ['26.96', 'Oct 1 2006'], ['27.66', 'Nov 1 2006'], ['28.13', 'Dec 1 2006'], ['29.07', 'Jan 1 2007'], ['26.63', 'Feb 1 2007'], ['26.35', 'Mar 1 2007'], ['28.3', 'Apr 1 2007'], ['29.11', 'May 1 2007'], ['27.95', 'Jun 1 2007'], ['27.5', 'Jul 1 2007'], ['27.34', 'Aug 1 2007'], ['28.04', 'Sep 1 2007'], ['35.03', 'Oct 1 2007'], ['32.09', 'Nov 1 2007'], ['34', 'Dec 1 2007'], ['31.13', 'Jan 1 2008'], ['26.07', 'Feb 1 2008'], ['27.21', 'Mar 1 2008'], ['27.34', 'Apr 1 2008'], ['27.25', 'May 1 2008'], ['26.47', 'Jun 1 2008'], ['24.75', 'Jul 1 2008'], ['26.36', 'Aug 1 2008'], ['25.78', 'Sep 1 2008'], ['21.57', 'Oct 1 2008'], ['19.66', 'Nov 1 2008'], ['18.91', 'Dec 1 2008'], ['16.63', 'Jan 1 2009'], ['15.81', 'Feb 1 2009'], ['17.99', 'Mar 1 2009'], ['19.84', 'Apr 1 2009'], ['20.59', 'May 1 2009'], ['23.42', 'Jun 1 2009'], ['23.18', 'Jul 1 2009'], ['24.43', 'Aug 1 2009'], ['25.49', 'Sep 1 2009'], ['27.48', 'Oct 1 2009'], ['29.27', 'Nov 1 2009'], ['30.34', 'Dec 1 2009'], ['28.05', 'Jan 1 2010'], ['28.67', 'Feb 1 2010'], ['28.8', 'Mar 1 2010']], parent: ['MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT', 'MSFT']}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '0 values.', data: '200 to 400', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '0 values.', data: '400 to 600', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '0 values.', data: '600 to 800', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '0 values.', data: '800 to 1000', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '0 values.', data: '1000 to 1200', parent: '"MSFT".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}]}]
      },
      {
        type: 'facet',
        tokens: {
          index: '2 of 5.',
          type: 'Line chart.',
          name: '"AMZN".',
          children: 'Axes "date" and "price".'
        },
        children: 
[{type: 'axis', tokens: {type: 'Temporal scale.', size: '6 grid sections.', data: 'Values from "Jan 1, 2000" to "Jan 1, 2010."', parent: '"AMZN".', name: 'X-axis titled "date".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '0 values.', data: 'Jan 1, 1998 to Jan 1, 2000.', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '24 values.', data: 'Jan 1, 2000 to Jan 1, 2002.', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [['64.56', 'Jan 1 2000'], ['68.87', 'Feb 1 2000'], ['67', 'Mar 1 2000'], ['55.19', 'Apr 1 2000'], ['48.31', 'May 1 2000'], ['36.31', 'Jun 1 2000'], ['30.12', 'Jul 1 2000'], ['41.5', 'Aug 1 2000'], ['38.44', 'Sep 1 2000'], ['36.62', 'Oct 1 2000'], ['24.69', 'Nov 1 2000'], ['15.56', 'Dec 1 2000'], ['17.31', 'Jan 1 2001'], ['10.19', 'Feb 1 2001'], ['10.23', 'Mar 1 2001'], ['15.78', 'Apr 1 2001'], ['16.69', 'May 1 2001'], ['14.15', 'Jun 1 2001'], ['12.49', 'Jul 1 2001'], ['8.94', 'Aug 1 2001'], ['5.97', 'Sep 1 2001'], ['6.98', 'Oct 1 2001'], ['11.32', 'Nov 1 2001'], ['10.82', 'Dec 1 2001']], parent: ['AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN']}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '24 values.', data: 'Jan 1, 2002 to Jan 1, 2004.', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [['14.19', 'Jan 1 2002'], ['14.1', 'Feb 1 2002'], ['14.3', 'Mar 1 2002'], ['16.69', 'Apr 1 2002'], ['18.23', 'May 1 2002'], ['16.25', 'Jun 1 2002'], ['14.45', 'Jul 1 2002'], ['14.94', 'Aug 1 2002'], ['15.93', 'Sep 1 2002'], ['19.36', 'Oct 1 2002'], ['23.35', 'Nov 1 2002'], ['18.89', 'Dec 1 2002'], ['21.85', 'Jan 1 2003'], ['22.01', 'Feb 1 2003'], ['26.03', 'Mar 1 2003'], ['28.69', 'Apr 1 2003'], ['35.89', 'May 1 2003'], ['36.32', 'Jun 1 2003'], ['41.64', 'Jul 1 2003'], ['46.32', 'Aug 1 2003'], ['48.43', 'Sep 1 2003'], ['54.43', 'Oct 1 2003'], ['53.97', 'Nov 1 2003'], ['52.62', 'Dec 1 2003']], parent: ['AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN']}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '24 values.', data: 'Jan 1, 2004 to Jan 1, 2006.', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [['50.4', 'Jan 1 2004'], ['43.01', 'Feb 1 2004'], ['43.28', 'Mar 1 2004'], ['43.6', 'Apr 1 2004'], ['48.5', 'May 1 2004'], ['54.4', 'Jun 1 2004'], ['38.92', 'Jul 1 2004'], ['38.14', 'Aug 1 2004'], ['40.86', 'Sep 1 2004'], ['34.13', 'Oct 1 2004'], ['39.68', 'Nov 1 2004'], ['44.29', 'Dec 1 2004'], ['43.22', 'Jan 1 2005'], ['35.18', 'Feb 1 2005'], ['34.27', 'Mar 1 2005'], ['32.36', 'Apr 1 2005'], ['35.51', 'May 1 2005'], ['33.09', 'Jun 1 2005'], ['45.15', 'Jul 1 2005'], ['42.7', 'Aug 1 2005'], ['45.3', 'Sep 1 2005'], ['39.86', 'Oct 1 2005'], ['48.46', 'Nov 1 2005'], ['47.15', 'Dec 1 2005']], parent: ['AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN']}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '24 values.', data: 'Jan 1, 2006 to Jan 1, 2008.', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [['44.82', 'Jan 1 2006'], ['37.44', 'Feb 1 2006'], ['36.53', 'Mar 1 2006'], ['35.21', 'Apr 1 2006'], ['34.61', 'May 1 2006'], ['38.68', 'Jun 1 2006'], ['26.89', 'Jul 1 2006'], ['30.83', 'Aug 1 2006'], ['32.12', 'Sep 1 2006'], ['38.09', 'Oct 1 2006'], ['40.34', 'Nov 1 2006'], ['39.46', 'Dec 1 2006'], ['37.67', 'Jan 1 2007'], ['39.14', 'Feb 1 2007'], ['39.79', 'Mar 1 2007'], ['61.33', 'Apr 1 2007'], ['69.14', 'May 1 2007'], ['68.41', 'Jun 1 2007'], ['78.54', 'Jul 1 2007'], ['79.91', 'Aug 1 2007'], ['93.15', 'Sep 1 2007'], ['89.15', 'Oct 1 2007'], ['90.56', 'Nov 1 2007'], ['92.64', 'Dec 1 2007']], parent: ['AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN']}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '24 values.', data: 'Jan 1, 2008 to Jan 1, 2010.', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [['77.7', 'Jan 1 2008'], ['64.47', 'Feb 1 2008'], ['71.3', 'Mar 1 2008'], ['78.63', 'Apr 1 2008'], ['81.62', 'May 1 2008'], ['73.33', 'Jun 1 2008'], ['76.34', 'Jul 1 2008'], ['80.81', 'Aug 1 2008'], ['72.76', 'Sep 1 2008'], ['57.24', 'Oct 1 2008'], ['42.7', 'Nov 1 2008'], ['51.28', 'Dec 1 2008'], ['58.82', 'Jan 1 2009'], ['64.79', 'Feb 1 2009'], ['73.44', 'Mar 1 2009'], ['80.52', 'Apr 1 2009'], ['77.99', 'May 1 2009'], ['83.66', 'Jun 1 2009'], ['85.76', 'Jul 1 2009'], ['81.19', 'Aug 1 2009'], ['93.36', 'Sep 1 2009'], ['118.81', 'Oct 1 2009'], ['135.91', 'Nov 1 2009'], ['134.52', 'Dec 1 2009']], parent: ['AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN']}, children: []}]}, {type: 'section', tokens: {index: '6 of 6.', size: '3 values.', data: 'Jan 1, 2010 to Jan 1, 2012.', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [['125.41', 'Jan 1 2010'], ['118.4', 'Feb 1 2010'], ['128.82', 'Mar 1 2010']], parent: ['AMZN', 'AMZN', 'AMZN']}, children: []}]}]}, {type: 'axis', tokens: {type: 'Quantitative scale.', size: '4 grid sections.', data: 'Values from "0" to "800".', 'aggregate': 'The average value is 47.99, the minimum is 5.97, and the maximum is 135.91.', parent: '"AMZN".', name: 'Y-axis titled "price".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '123 values.', data: '0 to 200', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [['64.56', 'Jan 1 2000'], ['68.87', 'Feb 1 2000'], ['67', 'Mar 1 2000'], ['55.19', 'Apr 1 2000'], ['48.31', 'May 1 2000'], ['36.31', 'Jun 1 2000'], ['30.12', 'Jul 1 2000'], ['41.5', 'Aug 1 2000'], ['38.44', 'Sep 1 2000'], ['36.62', 'Oct 1 2000'], ['24.69', 'Nov 1 2000'], ['15.56', 'Dec 1 2000'], ['17.31', 'Jan 1 2001'], ['10.19', 'Feb 1 2001'], ['10.23', 'Mar 1 2001'], ['15.78', 'Apr 1 2001'], ['16.69', 'May 1 2001'], ['14.15', 'Jun 1 2001'], ['12.49', 'Jul 1 2001'], ['8.94', 'Aug 1 2001'], ['5.97', 'Sep 1 2001'], ['6.98', 'Oct 1 2001'], ['11.32', 'Nov 1 2001'], ['10.82', 'Dec 1 2001'], ['14.19', 'Jan 1 2002'], ['14.1', 'Feb 1 2002'], ['14.3', 'Mar 1 2002'], ['16.69', 'Apr 1 2002'], ['18.23', 'May 1 2002'], ['16.25', 'Jun 1 2002'], ['14.45', 'Jul 1 2002'], ['14.94', 'Aug 1 2002'], ['15.93', 'Sep 1 2002'], ['19.36', 'Oct 1 2002'], ['23.35', 'Nov 1 2002'], ['18.89', 'Dec 1 2002'], ['21.85', 'Jan 1 2003'], ['22.01', 'Feb 1 2003'], ['26.03', 'Mar 1 2003'], ['28.69', 'Apr 1 2003'], ['35.89', 'May 1 2003'], ['36.32', 'Jun 1 2003'], ['41.64', 'Jul 1 2003'], ['46.32', 'Aug 1 2003'], ['48.43', 'Sep 1 2003'], ['54.43', 'Oct 1 2003'], ['53.97', 'Nov 1 2003'], ['52.62', 'Dec 1 2003'], ['50.4', 'Jan 1 2004'], ['43.01', 'Feb 1 2004'], ['43.28', 'Mar 1 2004'], ['43.6', 'Apr 1 2004'], ['48.5', 'May 1 2004'], ['54.4', 'Jun 1 2004'], ['38.92', 'Jul 1 2004'], ['38.14', 'Aug 1 2004'], ['40.86', 'Sep 1 2004'], ['34.13', 'Oct 1 2004'], ['39.68', 'Nov 1 2004'], ['44.29', 'Dec 1 2004'], ['43.22', 'Jan 1 2005'], ['35.18', 'Feb 1 2005'], ['34.27', 'Mar 1 2005'], ['32.36', 'Apr 1 2005'], ['35.51', 'May 1 2005'], ['33.09', 'Jun 1 2005'], ['45.15', 'Jul 1 2005'], ['42.7', 'Aug 1 2005'], ['45.3', 'Sep 1 2005'], ['39.86', 'Oct 1 2005'], ['48.46', 'Nov 1 2005'], ['47.15', 'Dec 1 2005'], ['44.82', 'Jan 1 2006'], ['37.44', 'Feb 1 2006'], ['36.53', 'Mar 1 2006'], ['35.21', 'Apr 1 2006'], ['34.61', 'May 1 2006'], ['38.68', 'Jun 1 2006'], ['26.89', 'Jul 1 2006'], ['30.83', 'Aug 1 2006'], ['32.12', 'Sep 1 2006'], ['38.09', 'Oct 1 2006'], ['40.34', 'Nov 1 2006'], ['39.46', 'Dec 1 2006'], ['37.67', 'Jan 1 2007'], ['39.14', 'Feb 1 2007'], ['39.79', 'Mar 1 2007'], ['61.33', 'Apr 1 2007'], ['69.14', 'May 1 2007'], ['68.41', 'Jun 1 2007'], ['78.54', 'Jul 1 2007'], ['79.91', 'Aug 1 2007'], ['93.15', 'Sep 1 2007'], ['89.15', 'Oct 1 2007'], ['90.56', 'Nov 1 2007'], ['92.64', 'Dec 1 2007'], ['77.7', 'Jan 1 2008'], ['64.47', 'Feb 1 2008'], ['71.3', 'Mar 1 2008'], ['78.63', 'Apr 1 2008'], ['81.62', 'May 1 2008'], ['73.33', 'Jun 1 2008'], ['76.34', 'Jul 1 2008'], ['80.81', 'Aug 1 2008'], ['72.76', 'Sep 1 2008'], ['57.24', 'Oct 1 2008'], ['42.7', 'Nov 1 2008'], ['51.28', 'Dec 1 2008'], ['58.82', 'Jan 1 2009'], ['64.79', 'Feb 1 2009'], ['73.44', 'Mar 1 2009'], ['80.52', 'Apr 1 2009'], ['77.99', 'May 1 2009'], ['83.66', 'Jun 1 2009'], ['85.76', 'Jul 1 2009'], ['81.19', 'Aug 1 2009'], ['93.36', 'Sep 1 2009'], ['118.81', 'Oct 1 2009'], ['135.91', 'Nov 1 2009'], ['134.52', 'Dec 1 2009'], ['125.41', 'Jan 1 2010'], ['118.4', 'Feb 1 2010'], ['128.82', 'Mar 1 2010']], parent: ['AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN', 'AMZN']}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '0 values.', data: '200 to 400', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '0 values.', data: '400 to 600', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '0 values.', data: '600 to 800', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '0 values.', data: '800 to 1000', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '0 values.', data: '1000 to 1200', parent: '"AMZN".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}]}]
      },
      {
        type: 'facet',
        tokens: {
          index: '3 of 5.',
          type: 'Line chart.',
          name: '"IBM".',
          children: 'Axes "date" and "price".'
        },
        children: 
[{type: 'axis', tokens: {type: 'Temporal scale.', size: '6 grid sections.', data: 'Values from "Jan 1, 2000" to "Jan 1, 2010."', parent: '"IBM".', name: 'X-axis titled "date".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '0 values.', data: 'Jan 1, 1998 to Jan 1, 2000.', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '24 values.', data: 'Jan 1, 2000 to Jan 1, 2002.', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [['100.52', 'Jan 1 2000'], ['92.11', 'Feb 1 2000'], ['106.11', 'Mar 1 2000'], ['99.95', 'Apr 1 2000'], ['96.31', 'May 1 2000'], ['98.33', 'Jun 1 2000'], ['100.74', 'Jul 1 2000'], ['118.62', 'Aug 1 2000'], ['101.19', 'Sep 1 2000'], ['88.5', 'Oct 1 2000'], ['84.12', 'Nov 1 2000'], ['76.47', 'Dec 1 2000'], ['100.76', 'Jan 1 2001'], ['89.98', 'Feb 1 2001'], ['86.63', 'Mar 1 2001'], ['103.7', 'Apr 1 2001'], ['100.82', 'May 1 2001'], ['102.35', 'Jun 1 2001'], ['94.87', 'Jul 1 2001'], ['90.25', 'Aug 1 2001'], ['82.82', 'Sep 1 2001'], ['97.58', 'Oct 1 2001'], ['104.5', 'Nov 1 2001'], ['109.36', 'Dec 1 2001']], parent: ['IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM']}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '24 values.', data: 'Jan 1, 2002 to Jan 1, 2004.', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [['97.54', 'Jan 1 2002'], ['88.82', 'Feb 1 2002'], ['94.15', 'Mar 1 2002'], ['75.82', 'Apr 1 2002'], ['72.97', 'May 1 2002'], ['65.31', 'Jun 1 2002'], ['63.86', 'Jul 1 2002'], ['68.52', 'Aug 1 2002'], ['53.01', 'Sep 1 2002'], ['71.76', 'Oct 1 2002'], ['79.16', 'Nov 1 2002'], ['70.58', 'Dec 1 2002'], ['71.22', 'Jan 1 2003'], ['71.13', 'Feb 1 2003'], ['71.57', 'Mar 1 2003'], ['77.47', 'Apr 1 2003'], ['80.48', 'May 1 2003'], ['75.42', 'Jun 1 2003'], ['74.28', 'Jul 1 2003'], ['75.12', 'Aug 1 2003'], ['80.91', 'Sep 1 2003'], ['81.96', 'Oct 1 2003'], ['83.08', 'Nov 1 2003'], ['85.05', 'Dec 1 2003']], parent: ['IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM']}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '24 values.', data: 'Jan 1, 2004 to Jan 1, 2006.', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [['91.06', 'Jan 1 2004'], ['88.7', 'Feb 1 2004'], ['84.41', 'Mar 1 2004'], ['81.04', 'Apr 1 2004'], ['81.59', 'May 1 2004'], ['81.19', 'Jun 1 2004'], ['80.19', 'Jul 1 2004'], ['78.17', 'Aug 1 2004'], ['79.13', 'Sep 1 2004'], ['82.84', 'Oct 1 2004'], ['87.15', 'Nov 1 2004'], ['91.16', 'Dec 1 2004'], ['86.39', 'Jan 1 2005'], ['85.78', 'Feb 1 2005'], ['84.66', 'Mar 1 2005'], ['70.77', 'Apr 1 2005'], ['70.18', 'May 1 2005'], ['68.93', 'Jun 1 2005'], ['77.53', 'Jul 1 2005'], ['75.07', 'Aug 1 2005'], ['74.7', 'Sep 1 2005'], ['76.25', 'Oct 1 2005'], ['82.98', 'Nov 1 2005'], ['76.73', 'Dec 1 2005']], parent: ['IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM']}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '24 values.', data: 'Jan 1, 2006 to Jan 1, 2008.', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [['75.89', 'Jan 1 2006'], ['75.09', 'Feb 1 2006'], ['77.17', 'Mar 1 2006'], ['77.05', 'Apr 1 2006'], ['75.04', 'May 1 2006'], ['72.15', 'Jun 1 2006'], ['72.7', 'Jul 1 2006'], ['76.35', 'Aug 1 2006'], ['77.26', 'Sep 1 2006'], ['87.06', 'Oct 1 2006'], ['86.95', 'Nov 1 2006'], ['91.9', 'Dec 1 2006'], ['93.79', 'Jan 1 2007'], ['88.18', 'Feb 1 2007'], ['89.44', 'Mar 1 2007'], ['96.98', 'Apr 1 2007'], ['101.54', 'May 1 2007'], ['100.25', 'Jun 1 2007'], ['105.4', 'Jul 1 2007'], ['111.54', 'Aug 1 2007'], ['112.6', 'Sep 1 2007'], ['111', 'Oct 1 2007'], ['100.9', 'Nov 1 2007'], ['103.7', 'Dec 1 2007']], parent: ['IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM']}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '24 values.', data: 'Jan 1, 2008 to Jan 1, 2010.', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [['102.75', 'Jan 1 2008'], ['109.64', 'Feb 1 2008'], ['110.87', 'Mar 1 2008'], ['116.23', 'Apr 1 2008'], ['125.14', 'May 1 2008'], ['114.6', 'Jun 1 2008'], ['123.74', 'Jul 1 2008'], ['118.16', 'Aug 1 2008'], ['113.53', 'Sep 1 2008'], ['90.24', 'Oct 1 2008'], ['79.65', 'Nov 1 2008'], ['82.15', 'Dec 1 2008'], ['89.46', 'Jan 1 2009'], ['90.32', 'Feb 1 2009'], ['95.09', 'Mar 1 2009'], ['101.29', 'Apr 1 2009'], ['104.85', 'May 1 2009'], ['103.01', 'Jun 1 2009'], ['116.34', 'Jul 1 2009'], ['117', 'Aug 1 2009'], ['118.55', 'Sep 1 2009'], ['119.54', 'Oct 1 2009'], ['125.79', 'Nov 1 2009'], ['130.32', 'Dec 1 2009']], parent: ['IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM']}, children: []}]}, {type: 'section', tokens: {index: '6 of 6.', size: '3 values.', data: 'Jan 1, 2010 to Jan 1, 2012.', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [['121.85', 'Jan 1 2010'], ['127.16', 'Feb 1 2010'], ['125.55', 'Mar 1 2010']], parent: ['IBM', 'IBM', 'IBM']}, children: []}]}]}, {type: 'axis', tokens: {type: 'Quantitative scale.', size: '4 grid sections.', data: 'Values from "0" to "800".', 'aggregate': 'The average value is 91.26, the minimum is 53.01, and the maximum is 130.32.', parent: '"IBM".', name: 'Y-axis titled "price".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '123 values.', data: '0 to 200', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [['100.52', 'Jan 1 2000'], ['92.11', 'Feb 1 2000'], ['106.11', 'Mar 1 2000'], ['99.95', 'Apr 1 2000'], ['96.31', 'May 1 2000'], ['98.33', 'Jun 1 2000'], ['100.74', 'Jul 1 2000'], ['118.62', 'Aug 1 2000'], ['101.19', 'Sep 1 2000'], ['88.5', 'Oct 1 2000'], ['84.12', 'Nov 1 2000'], ['76.47', 'Dec 1 2000'], ['100.76', 'Jan 1 2001'], ['89.98', 'Feb 1 2001'], ['86.63', 'Mar 1 2001'], ['103.7', 'Apr 1 2001'], ['100.82', 'May 1 2001'], ['102.35', 'Jun 1 2001'], ['94.87', 'Jul 1 2001'], ['90.25', 'Aug 1 2001'], ['82.82', 'Sep 1 2001'], ['97.58', 'Oct 1 2001'], ['104.5', 'Nov 1 2001'], ['109.36', 'Dec 1 2001'], ['97.54', 'Jan 1 2002'], ['88.82', 'Feb 1 2002'], ['94.15', 'Mar 1 2002'], ['75.82', 'Apr 1 2002'], ['72.97', 'May 1 2002'], ['65.31', 'Jun 1 2002'], ['63.86', 'Jul 1 2002'], ['68.52', 'Aug 1 2002'], ['53.01', 'Sep 1 2002'], ['71.76', 'Oct 1 2002'], ['79.16', 'Nov 1 2002'], ['70.58', 'Dec 1 2002'], ['71.22', 'Jan 1 2003'], ['71.13', 'Feb 1 2003'], ['71.57', 'Mar 1 2003'], ['77.47', 'Apr 1 2003'], ['80.48', 'May 1 2003'], ['75.42', 'Jun 1 2003'], ['74.28', 'Jul 1 2003'], ['75.12', 'Aug 1 2003'], ['80.91', 'Sep 1 2003'], ['81.96', 'Oct 1 2003'], ['83.08', 'Nov 1 2003'], ['85.05', 'Dec 1 2003'], ['91.06', 'Jan 1 2004'], ['88.7', 'Feb 1 2004'], ['84.41', 'Mar 1 2004'], ['81.04', 'Apr 1 2004'], ['81.59', 'May 1 2004'], ['81.19', 'Jun 1 2004'], ['80.19', 'Jul 1 2004'], ['78.17', 'Aug 1 2004'], ['79.13', 'Sep 1 2004'], ['82.84', 'Oct 1 2004'], ['87.15', 'Nov 1 2004'], ['91.16', 'Dec 1 2004'], ['86.39', 'Jan 1 2005'], ['85.78', 'Feb 1 2005'], ['84.66', 'Mar 1 2005'], ['70.77', 'Apr 1 2005'], ['70.18', 'May 1 2005'], ['68.93', 'Jun 1 2005'], ['77.53', 'Jul 1 2005'], ['75.07', 'Aug 1 2005'], ['74.7', 'Sep 1 2005'], ['76.25', 'Oct 1 2005'], ['82.98', 'Nov 1 2005'], ['76.73', 'Dec 1 2005'], ['75.89', 'Jan 1 2006'], ['75.09', 'Feb 1 2006'], ['77.17', 'Mar 1 2006'], ['77.05', 'Apr 1 2006'], ['75.04', 'May 1 2006'], ['72.15', 'Jun 1 2006'], ['72.7', 'Jul 1 2006'], ['76.35', 'Aug 1 2006'], ['77.26', 'Sep 1 2006'], ['87.06', 'Oct 1 2006'], ['86.95', 'Nov 1 2006'], ['91.9', 'Dec 1 2006'], ['93.79', 'Jan 1 2007'], ['88.18', 'Feb 1 2007'], ['89.44', 'Mar 1 2007'], ['96.98', 'Apr 1 2007'], ['101.54', 'May 1 2007'], ['100.25', 'Jun 1 2007'], ['105.4', 'Jul 1 2007'], ['111.54', 'Aug 1 2007'], ['112.6', 'Sep 1 2007'], ['111', 'Oct 1 2007'], ['100.9', 'Nov 1 2007'], ['103.7', 'Dec 1 2007'], ['102.75', 'Jan 1 2008'], ['109.64', 'Feb 1 2008'], ['110.87', 'Mar 1 2008'], ['116.23', 'Apr 1 2008'], ['125.14', 'May 1 2008'], ['114.6', 'Jun 1 2008'], ['123.74', 'Jul 1 2008'], ['118.16', 'Aug 1 2008'], ['113.53', 'Sep 1 2008'], ['90.24', 'Oct 1 2008'], ['79.65', 'Nov 1 2008'], ['82.15', 'Dec 1 2008'], ['89.46', 'Jan 1 2009'], ['90.32', 'Feb 1 2009'], ['95.09', 'Mar 1 2009'], ['101.29', 'Apr 1 2009'], ['104.85', 'May 1 2009'], ['103.01', 'Jun 1 2009'], ['116.34', 'Jul 1 2009'], ['117', 'Aug 1 2009'], ['118.55', 'Sep 1 2009'], ['119.54', 'Oct 1 2009'], ['125.79', 'Nov 1 2009'], ['130.32', 'Dec 1 2009'], ['121.85', 'Jan 1 2010'], ['127.16', 'Feb 1 2010'], ['125.55', 'Mar 1 2010']], parent: ['IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM', 'IBM']}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '0 values.', data: '200 to 400', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '0 values.', data: '400 to 600', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '0 values.', data: '600 to 800', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '0 values.', data: '800 to 1000', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '0 values.', data: '1000 to 1200', parent: '"IBM".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}]}]
      },
      {
        type: 'facet',
        tokens: {
          index: '4 of 5.',
          type: 'Line chart.',
          name: '"GOOG".',
          children: 'Axes "date" and "price".'
        },
        children: 
[{type: 'axis', tokens: {type: 'Temporal scale.', size: '6 grid sections.', data: 'Values from "Jan 1, 2000" to "Jan 1, 2010."', parent: '"GOOG".', name: 'X-axis titled "date".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '0 values.', data: 'Jan 1, 1998 to Jan 1, 2000.', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '0 values.', data: 'Jan 1, 2000 to Jan 1, 2002.', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '0 values.', data: 'Jan 1, 2002 to Jan 1, 2004.', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '17 values.', data: 'Jan 1, 2004 to Jan 1, 2006.', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [['102.37', 'Aug 1 2004'], ['129.6', 'Sep 1 2004'], ['190.64', 'Oct 1 2004'], ['181.98', 'Nov 1 2004'], ['192.79', 'Dec 1 2004'], ['195.62', 'Jan 1 2005'], ['187.99', 'Feb 1 2005'], ['180.51', 'Mar 1 2005'], ['220', 'Apr 1 2005'], ['277.27', 'May 1 2005'], ['294.15', 'Jun 1 2005'], ['287.76', 'Jul 1 2005'], ['286', 'Aug 1 2005'], ['316.46', 'Sep 1 2005'], ['372.14', 'Oct 1 2005'], ['404.91', 'Nov 1 2005'], ['414.86', 'Dec 1 2005']], parent: ['GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG']}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '24 values.', data: 'Jan 1, 2006 to Jan 1, 2008.', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [['432.66', 'Jan 1 2006'], ['362.62', 'Feb 1 2006'], ['390', 'Mar 1 2006'], ['417.94', 'Apr 1 2006'], ['371.82', 'May 1 2006'], ['419.33', 'Jun 1 2006'], ['386.6', 'Jul 1 2006'], ['378.53', 'Aug 1 2006'], ['401.9', 'Sep 1 2006'], ['476.39', 'Oct 1 2006'], ['484.81', 'Nov 1 2006'], ['460.48', 'Dec 1 2006'], ['501.5', 'Jan 1 2007'], ['449.45', 'Feb 1 2007'], ['458.16', 'Mar 1 2007'], ['471.38', 'Apr 1 2007'], ['497.91', 'May 1 2007'], ['522.7', 'Jun 1 2007'], ['510', 'Jul 1 2007'], ['515.25', 'Aug 1 2007'], ['567.27', 'Sep 1 2007'], ['707', 'Oct 1 2007'], ['693', 'Nov 1 2007'], ['691.48', 'Dec 1 2007']], parent: ['GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG']}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '24 values.', data: 'Jan 1, 2008 to Jan 1, 2010.', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [['564.3', 'Jan 1 2008'], ['471.18', 'Feb 1 2008'], ['440.47', 'Mar 1 2008'], ['574.29', 'Apr 1 2008'], ['585.8', 'May 1 2008'], ['526.42', 'Jun 1 2008'], ['473.75', 'Jul 1 2008'], ['463.29', 'Aug 1 2008'], ['400.52', 'Sep 1 2008'], ['359.36', 'Oct 1 2008'], ['292.96', 'Nov 1 2008'], ['307.65', 'Dec 1 2008'], ['338.53', 'Jan 1 2009'], ['337.99', 'Feb 1 2009'], ['348.06', 'Mar 1 2009'], ['395.97', 'Apr 1 2009'], ['417.23', 'May 1 2009'], ['421.59', 'Jun 1 2009'], ['443.05', 'Jul 1 2009'], ['461.67', 'Aug 1 2009'], ['495.85', 'Sep 1 2009'], ['536.12', 'Oct 1 2009'], ['583', 'Nov 1 2009'], ['619.98', 'Dec 1 2009']], parent: ['GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG']}, children: []}]}, {type: 'section', tokens: {index: '6 of 6.', size: '3 values.', data: 'Jan 1, 2010 to Jan 1, 2012.', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [['529.94', 'Jan 1 2010'], ['526.8', 'Feb 1 2010'], ['560.19', 'Mar 1 2010']], parent: ['GOOG', 'GOOG', 'GOOG']}, children: []}]}]}, {type: 'axis', tokens: {type: 'Quantitative scale.', size: '4 grid sections.', data: 'Values from "0" to "800".', 'aggregate': 'The average value is 415.87, the minimum is 102.37, and the maximum is 707.0.', parent: '"GOOG".', name: 'Y-axis titled "price".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '8 values.', data: '0 to 200', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [['102.37', 'Aug 1 2004'], ['129.6', 'Sep 1 2004'], ['190.64', 'Oct 1 2004'], ['181.98', 'Nov 1 2004'], ['192.79', 'Dec 1 2004'], ['195.62', 'Jan 1 2005'], ['187.99', 'Feb 1 2005'], ['180.51', 'Mar 1 2005']], parent: ['GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG']}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '19 values.', data: '200 to 400', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [['220', 'Apr 1 2005'], ['277.27', 'May 1 2005'], ['294.15', 'Jun 1 2005'], ['287.76', 'Jul 1 2005'], ['286', 'Aug 1 2005'], ['316.46', 'Sep 1 2005'], ['372.14', 'Oct 1 2005'], ['362.62', 'Feb 1 2006'], ['390', 'Mar 1 2006'], ['371.82', 'May 1 2006'], ['386.6', 'Jul 1 2006'], ['378.53', 'Aug 1 2006'], ['359.36', 'Oct 1 2008'], ['292.96', 'Nov 1 2008'], ['307.65', 'Dec 1 2008'], ['338.53', 'Jan 1 2009'], ['337.99', 'Feb 1 2009'], ['348.06', 'Mar 1 2009'], ['395.97', 'Apr 1 2009']], parent: ['GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG']}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '37 values.', data: '400 to 600', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [['404.91', 'Nov 1 2005'], ['414.86', 'Dec 1 2005'], ['432.66', 'Jan 1 2006'], ['417.94', 'Apr 1 2006'], ['419.33', 'Jun 1 2006'], ['401.9', 'Sep 1 2006'], ['476.39', 'Oct 1 2006'], ['484.81', 'Nov 1 2006'], ['460.48', 'Dec 1 2006'], ['501.5', 'Jan 1 2007'], ['449.45', 'Feb 1 2007'], ['458.16', 'Mar 1 2007'], ['471.38', 'Apr 1 2007'], ['497.91', 'May 1 2007'], ['522.7', 'Jun 1 2007'], ['510', 'Jul 1 2007'], ['515.25', 'Aug 1 2007'], ['567.27', 'Sep 1 2007'], ['564.3', 'Jan 1 2008'], ['471.18', 'Feb 1 2008'], ['440.47', 'Mar 1 2008'], ['574.29', 'Apr 1 2008'], ['585.8', 'May 1 2008'], ['526.42', 'Jun 1 2008'], ['473.75', 'Jul 1 2008'], ['463.29', 'Aug 1 2008'], ['400.52', 'Sep 1 2008'], ['417.23', 'May 1 2009'], ['421.59', 'Jun 1 2009'], ['443.05', 'Jul 1 2009'], ['461.67', 'Aug 1 2009'], ['495.85', 'Sep 1 2009'], ['536.12', 'Oct 1 2009'], ['583', 'Nov 1 2009'], ['529.94', 'Jan 1 2010'], ['526.8', 'Feb 1 2010'], ['560.19', 'Mar 1 2010']], parent: ['GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG', 'GOOG']}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '4 values.', data: '600 to 800', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [['707', 'Oct 1 2007'], ['693', 'Nov 1 2007'], ['691.48', 'Dec 1 2007'], ['619.98', 'Dec 1 2009']], parent: ['GOOG', 'GOOG', 'GOOG', 'GOOG']}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '0 values.', data: '800 to 1000', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '0 values.', data: '1000 to 1200', parent: '"GOOG".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}]}]
      },
      {
        type: 'facet',
        tokens: {
          index: '5 of 5.',
          type: 'Line chart.',
          name: '"AAPL".',
          children: 'Axes "date" and "price".'
        },
        children: 
[{type: 'axis', tokens: {type: 'Temporal scale.', size: '6 grid sections.', data: 'Values from "Jan 1, 2000" to "Jan 1, 2010."', parent: '"AAPL".', name: 'X-axis titled "date".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '0 values.', data: 'Jan 1, 1998 to Jan 1, 2000.', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '24 values.', data: 'Jan 1, 2000 to Jan 1, 2002.', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [['25.94', 'Jan 1 2000'], ['28.66', 'Feb 1 2000'], ['33.95', 'Mar 1 2000'], ['31.01', 'Apr 1 2000'], ['21', 'May 1 2000'], ['26.19', 'Jun 1 2000'], ['25.41', 'Jul 1 2000'], ['30.47', 'Aug 1 2000'], ['12.88', 'Sep 1 2000'], ['9.78', 'Oct 1 2000'], ['8.25', 'Nov 1 2000'], ['7.44', 'Dec 1 2000'], ['10.81', 'Jan 1 2001'], ['9.12', 'Feb 1 2001'], ['11.03', 'Mar 1 2001'], ['12.74', 'Apr 1 2001'], ['9.98', 'May 1 2001'], ['11.62', 'Jun 1 2001'], ['9.4', 'Jul 1 2001'], ['9.27', 'Aug 1 2001'], ['7.76', 'Sep 1 2001'], ['8.78', 'Oct 1 2001'], ['10.65', 'Nov 1 2001'], ['10.95', 'Dec 1 2001']], parent: ['AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL']}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '24 values.', data: 'Jan 1, 2002 to Jan 1, 2004.', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [['12.36', 'Jan 1 2002'], ['10.85', 'Feb 1 2002'], ['11.84', 'Mar 1 2002'], ['12.14', 'Apr 1 2002'], ['11.65', 'May 1 2002'], ['8.86', 'Jun 1 2002'], ['7.63', 'Jul 1 2002'], ['7.38', 'Aug 1 2002'], ['7.25', 'Sep 1 2002'], ['8.03', 'Oct 1 2002'], ['7.75', 'Nov 1 2002'], ['7.16', 'Dec 1 2002'], ['7.18', 'Jan 1 2003'], ['7.51', 'Feb 1 2003'], ['7.07', 'Mar 1 2003'], ['7.11', 'Apr 1 2003'], ['8.98', 'May 1 2003'], ['9.53', 'Jun 1 2003'], ['10.54', 'Jul 1 2003'], ['11.31', 'Aug 1 2003'], ['10.36', 'Sep 1 2003'], ['11.44', 'Oct 1 2003'], ['10.45', 'Nov 1 2003'], ['10.69', 'Dec 1 2003']], parent: ['AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL']}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '24 values.', data: 'Jan 1, 2004 to Jan 1, 2006.', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [['11.28', 'Jan 1 2004'], ['11.96', 'Feb 1 2004'], ['13.52', 'Mar 1 2004'], ['12.89', 'Apr 1 2004'], ['14.03', 'May 1 2004'], ['16.27', 'Jun 1 2004'], ['16.17', 'Jul 1 2004'], ['17.25', 'Aug 1 2004'], ['19.38', 'Sep 1 2004'], ['26.2', 'Oct 1 2004'], ['33.53', 'Nov 1 2004'], ['32.2', 'Dec 1 2004'], ['38.45', 'Jan 1 2005'], ['44.86', 'Feb 1 2005'], ['41.67', 'Mar 1 2005'], ['36.06', 'Apr 1 2005'], ['39.76', 'May 1 2005'], ['36.81', 'Jun 1 2005'], ['42.65', 'Jul 1 2005'], ['46.89', 'Aug 1 2005'], ['53.61', 'Sep 1 2005'], ['57.59', 'Oct 1 2005'], ['67.82', 'Nov 1 2005'], ['71.89', 'Dec 1 2005']], parent: ['AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL']}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '24 values.', data: 'Jan 1, 2006 to Jan 1, 2008.', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [['75.51', 'Jan 1 2006'], ['68.49', 'Feb 1 2006'], ['62.72', 'Mar 1 2006'], ['70.39', 'Apr 1 2006'], ['59.77', 'May 1 2006'], ['57.27', 'Jun 1 2006'], ['67.96', 'Jul 1 2006'], ['67.85', 'Aug 1 2006'], ['76.98', 'Sep 1 2006'], ['81.08', 'Oct 1 2006'], ['91.66', 'Nov 1 2006'], ['84.84', 'Dec 1 2006'], ['85.73', 'Jan 1 2007'], ['84.61', 'Feb 1 2007'], ['92.91', 'Mar 1 2007'], ['99.8', 'Apr 1 2007'], ['121.19', 'May 1 2007'], ['122.04', 'Jun 1 2007'], ['131.76', 'Jul 1 2007'], ['138.48', 'Aug 1 2007'], ['153.47', 'Sep 1 2007'], ['189.95', 'Oct 1 2007'], ['182.22', 'Nov 1 2007'], ['198.08', 'Dec 1 2007']], parent: ['AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL']}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '24 values.', data: 'Jan 1, 2008 to Jan 1, 2010.', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [['135.36', 'Jan 1 2008'], ['125.02', 'Feb 1 2008'], ['143.5', 'Mar 1 2008'], ['173.95', 'Apr 1 2008'], ['188.75', 'May 1 2008'], ['167.44', 'Jun 1 2008'], ['158.95', 'Jul 1 2008'], ['169.53', 'Aug 1 2008'], ['113.66', 'Sep 1 2008'], ['107.59', 'Oct 1 2008'], ['92.67', 'Nov 1 2008'], ['85.35', 'Dec 1 2008'], ['90.13', 'Jan 1 2009'], ['89.31', 'Feb 1 2009'], ['105.12', 'Mar 1 2009'], ['125.83', 'Apr 1 2009'], ['135.81', 'May 1 2009'], ['142.43', 'Jun 1 2009'], ['163.39', 'Jul 1 2009'], ['168.21', 'Aug 1 2009'], ['185.35', 'Sep 1 2009'], ['188.5', 'Oct 1 2009'], ['199.91', 'Nov 1 2009'], ['210.73', 'Dec 1 2009']], parent: ['AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL']}, children: []}]}, {type: 'section', tokens: {index: '6 of 6.', size: '3 values.', data: 'Jan 1, 2010 to Jan 1, 2012.', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [['192.06', 'Jan 1 2010'], ['204.62', 'Feb 1 2010'], ['223.02', 'Mar 1 2010']], parent: ['AAPL', 'AAPL', 'AAPL']}, children: []}]}]}, {type: 'axis', tokens: {type: 'Quantitative scale.', size: '4 grid sections.', data: 'Values from "0" to "800".', 'aggregate': 'The average value is 64.73, the minimum is 7.07, and the maximum is 223.02.', parent: '"AAPL".', name: 'Y-axis titled "price".'}, children: [{type: 'section', tokens: {index: '0 of 6.', size: '120 values.', data: '0 to 200', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [['25.94', 'Jan 1 2000'], ['28.66', 'Feb 1 2000'], ['33.95', 'Mar 1 2000'], ['31.01', 'Apr 1 2000'], ['21', 'May 1 2000'], ['26.19', 'Jun 1 2000'], ['25.41', 'Jul 1 2000'], ['30.47', 'Aug 1 2000'], ['12.88', 'Sep 1 2000'], ['9.78', 'Oct 1 2000'], ['8.25', 'Nov 1 2000'], ['7.44', 'Dec 1 2000'], ['10.81', 'Jan 1 2001'], ['9.12', 'Feb 1 2001'], ['11.03', 'Mar 1 2001'], ['12.74', 'Apr 1 2001'], ['9.98', 'May 1 2001'], ['11.62', 'Jun 1 2001'], ['9.4', 'Jul 1 2001'], ['9.27', 'Aug 1 2001'], ['7.76', 'Sep 1 2001'], ['8.78', 'Oct 1 2001'], ['10.65', 'Nov 1 2001'], ['10.95', 'Dec 1 2001'], ['12.36', 'Jan 1 2002'], ['10.85', 'Feb 1 2002'], ['11.84', 'Mar 1 2002'], ['12.14', 'Apr 1 2002'], ['11.65', 'May 1 2002'], ['8.86', 'Jun 1 2002'], ['7.63', 'Jul 1 2002'], ['7.38', 'Aug 1 2002'], ['7.25', 'Sep 1 2002'], ['8.03', 'Oct 1 2002'], ['7.75', 'Nov 1 2002'], ['7.16', 'Dec 1 2002'], ['7.18', 'Jan 1 2003'], ['7.51', 'Feb 1 2003'], ['7.07', 'Mar 1 2003'], ['7.11', 'Apr 1 2003'], ['8.98', 'May 1 2003'], ['9.53', 'Jun 1 2003'], ['10.54', 'Jul 1 2003'], ['11.31', 'Aug 1 2003'], ['10.36', 'Sep 1 2003'], ['11.44', 'Oct 1 2003'], ['10.45', 'Nov 1 2003'], ['10.69', 'Dec 1 2003'], ['11.28', 'Jan 1 2004'], ['11.96', 'Feb 1 2004'], ['13.52', 'Mar 1 2004'], ['12.89', 'Apr 1 2004'], ['14.03', 'May 1 2004'], ['16.27', 'Jun 1 2004'], ['16.17', 'Jul 1 2004'], ['17.25', 'Aug 1 2004'], ['19.38', 'Sep 1 2004'], ['26.2', 'Oct 1 2004'], ['33.53', 'Nov 1 2004'], ['32.2', 'Dec 1 2004'], ['38.45', 'Jan 1 2005'], ['44.86', 'Feb 1 2005'], ['41.67', 'Mar 1 2005'], ['36.06', 'Apr 1 2005'], ['39.76', 'May 1 2005'], ['36.81', 'Jun 1 2005'], ['42.65', 'Jul 1 2005'], ['46.89', 'Aug 1 2005'], ['53.61', 'Sep 1 2005'], ['57.59', 'Oct 1 2005'], ['67.82', 'Nov 1 2005'], ['71.89', 'Dec 1 2005'], ['75.51', 'Jan 1 2006'], ['68.49', 'Feb 1 2006'], ['62.72', 'Mar 1 2006'], ['70.39', 'Apr 1 2006'], ['59.77', 'May 1 2006'], ['57.27', 'Jun 1 2006'], ['67.96', 'Jul 1 2006'], ['67.85', 'Aug 1 2006'], ['76.98', 'Sep 1 2006'], ['81.08', 'Oct 1 2006'], ['91.66', 'Nov 1 2006'], ['84.84', 'Dec 1 2006'], ['85.73', 'Jan 1 2007'], ['84.61', 'Feb 1 2007'], ['92.91', 'Mar 1 2007'], ['99.8', 'Apr 1 2007'], ['121.19', 'May 1 2007'], ['122.04', 'Jun 1 2007'], ['131.76', 'Jul 1 2007'], ['138.48', 'Aug 1 2007'], ['153.47', 'Sep 1 2007'], ['189.95', 'Oct 1 2007'], ['182.22', 'Nov 1 2007'], ['198.08', 'Dec 1 2007'], ['135.36', 'Jan 1 2008'], ['125.02', 'Feb 1 2008'], ['143.5', 'Mar 1 2008'], ['173.95', 'Apr 1 2008'], ['188.75', 'May 1 2008'], ['167.44', 'Jun 1 2008'], ['158.95', 'Jul 1 2008'], ['169.53', 'Aug 1 2008'], ['113.66', 'Sep 1 2008'], ['107.59', 'Oct 1 2008'], ['92.67', 'Nov 1 2008'], ['85.35', 'Dec 1 2008'], ['90.13', 'Jan 1 2009'], ['89.31', 'Feb 1 2009'], ['105.12', 'Mar 1 2009'], ['125.83', 'Apr 1 2009'], ['135.81', 'May 1 2009'], ['142.43', 'Jun 1 2009'], ['163.39', 'Jul 1 2009'], ['168.21', 'Aug 1 2009'], ['185.35', 'Sep 1 2009'], ['188.5', 'Oct 1 2009'], ['199.91', 'Nov 1 2009'], ['192.06', 'Jan 1 2010']], parent: ['AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL', 'AAPL']}, children: []}]}, {type: 'section', tokens: {index: '1 of 6.', size: '3 values.', data: '200 to 400', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [['210.73', 'Dec 1 2009'], ['204.62', 'Feb 1 2010'], ['223.02', 'Mar 1 2010']], parent: ['AAPL', 'AAPL', 'AAPL']}, children: []}]}, {type: 'section', tokens: {index: '2 of 6.', size: '0 values.', data: '400 to 600', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '3 of 6.', size: '0 values.', data: '600 to 800', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '4 of 6.', size: '0 values.', data: '800 to 1000', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}, {type: 'section', tokens: {index: '5 of 6.', size: '0 values.', data: '1000 to 1200', parent: '"AAPL".'}, children: [{type: 'datapoint', tokens: {data: [], parent: []}, children: []}]}]}]
      }
    ]
  }

  const descriptionAccesskey = "d";
  displayRootDescription();


  function displayRootDescription() {
    const desc = document.getElementById('description');
    desc.innerHTML = '';
    displayRecursiveDescription(tree, desc);
    desc.firstElementChild.setAttribute('accesskey', descriptionAccesskey)
  }

  // `tree` is the tree to generate a description for
  // `dom` is where to add that description
  // `id` is so you can track back from DOM to tree
  // `flags` are any description tokens to turn on
  function displayRecursiveDescription(tree, dom, id = '0', flags=[]) {
    const root = document.createElement('li');
    root.setAttribute('tabindex', 0);
    root.setAttribute('id', id);
    root.classList.add('no-list-style');
    root.setAttribute('onfocus', 'lastActiveDescriptionId = this.id; setDescriptionAccesskey(this);');

    indivDesc = getIndivDescription(tree, flags)
    if (indivDesc) { root.appendChild(indivDesc); }

    if (tree.children.length > 0) {
      const container = document.createElement('ul');
      for (childIdx in tree.children) {
        displayRecursiveDescription(tree.children[childIdx], container, id + '-' + childIdx);
      }
      root.appendChild(container);
    }
    dom.appendChild(root);
  }

  function tokenSort(tokenOrder) {
    // Put all unlisted tokens first, then order remaining tokens by their order in tokenOrder
    return (token1, token2) => {
      includes1 = tokenOrder.includes(token1);
      includes2 = tokenOrder.includes(token2);

      if (!includes1 && !includes2) {
        return 0;
      } else if (!includes1) {
        return -1;
      } else if (!includes2) {
        return 1;
      }
      return tokenOrder.indexOf(token1) - tokenOrder.indexOf(token2);
    }
  }

  function getIndivDescription(node, flags) {
    const verbosity = document.getElementById(`${node.type}-verbosity`);
    if (!flags) { flags = [] }
    if (verbosity) {
      verbSettings = controls[node.type]['options'][verbosity.value]
      tokenInclude = [...new Set([...verbSettings, ...flags])] // set union of the two arrays
    } else {
      tokenInclude = TOKEN_TYPES
    }
    let text = '';

    if (node.type !== 'datapoint') {
      for (token of (Object.keys(node.tokens)).sort(tokenSort(tokenInclude))) { // TODO
        const checkbox = document.getElementById(token);
        let tokenText = node.tokens[token];

        if (tokenInclude.includes(token)) { 
          text += tokenText + ' ';
        }
      }
      result = document.createElement('span');
      result.innerText = text
    } else { // Make a table
      if (node.tokens.data.length === 0) {
        return null;
      }
      include = [...tokenInclude]
      include.splice(include.indexOf('data'), 1)
      include.push('price')
      include.push('date')
      if (include.includes('parent')) { include[include.indexOf('parent')] = 'symbol' };
      result = renderTable(refactorDatapoints(node.tokens, tokenInclude), include);
    }

    return result;
  }

  function getTreeNode(id) {
    const idxs = id.split('-');
    let node = tree;
    for (idx of idxs.slice(1)) {
      node = node.children[idx];
    }
    return node;
  }

  // Set a particular part of the description to have the d accesskey
  function setDescriptionAccesskey(elt) {
    document.querySelectorAll(`[accesskey="${descriptionAccesskey}"]`).forEach(el => el.removeAttribute('accesskey'));
    elt.setAttribute('accesskey', descriptionAccesskey);
  }

  function refactorDatapoints(tokens, include) {
    data = []
    for (let i = 0; i < tokens['data'].length; i++) {
      datapoint = {}
      datapoint["price"] = tokens['data'][i][0]
      datapoint["date"] = tokens['data'][i][1]
      for (let field of include) {
        if (field === 'data') { continue; } // Data is split out by axis
        if (field === 'parent') { // rename for legibility?
          datapoint['symbol'] = tokens[field][i]
        } else {
          datapoint[field] = tokens[field][i]
        }
      }
      data.push(datapoint)
    }
    return data;
  }

  // Create a datatable given an array of data objects and a list of their string keys
  function renderTable(data, fieldsUsed) {
    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const theadtr = document.createElement("tr");

    fieldsUsed.forEach((field) => {
        const th = document.createElement("th");
        th.setAttribute('scope', 'col');
        th.innerText = field;
        theadtr.appendChild(th);
    });

    thead.appendChild(theadtr);
    table.appendChild(thead);

    const tableBody = document.createElement("tbody");

    data.forEach((data) => {
        const dataRow = document.createElement("tr")
        fieldsUsed.forEach((field) => {
            const td = document.createElement("td")
            td.innerText = data[field];
            dataRow.appendChild(td);
        })
        tableBody.appendChild(dataRow);
    })
    table.appendChild(tableBody);

    return table;
  }

  /***
   *  Event listeners for the description
   ***/
  document.onkeydown = function (e) {
    keyboardCommands(e);
    keyboardNavigation(e);
  };

  let keylog = '';
  const dropdownNames = ['flow', 'fhigh', 'alow', 'ahigh', 'slow', 'shigh', 'dlow', 'dhigh']
  function keyboardCommands(e) {
    let keypressed = e.key;

    if (e.ctrlKey && keypressed === 'm') {
      document.getElementById('settings').focus()
    } else if (e.ctrlKey && keypressed === 'd') {
      document.getElementById(lastActiveDescriptionId).focus()
    }

    keylog += keypressed;
    for (dropdownName of dropdownNames) {
      if (keylog.slice(keylog.length - dropdownName.length) === dropdownName) {
        const curFocus = document.activeElement.id
        const value = dropdownName.slice(1)
        const mapping = {'f': 'facet-verbosity', 'a': 'axis-verbosity', 's': 'section-verbosity', 'd': 'datapoint-verbosity'}
        id = mapping[dropdownName.slice(0, 1)]

        document.getElementById(id).value = value
        updateDescription(document.getElementById(id));

        document.getElementById(curFocus).focus()
        document.getElementById(curFocus).setAttribute('aria-active', true);
      }
    }
    for (tokenName of TOKEN_TYPES) {
      if (keylog.slice(keylog.length - tokenName.length) === tokenName) {
        const node = getTreeNode(document.activeElement.id);
        console.log(document.activeElement.firstChild);
        document.activeElement.firstChild.replaceWith(getIndivDescription(node, [tokenName]));
        srSpeak(document.activeElement.firstChild.innerText);
      }
    }
  }

  document.addEventListener('keydown', (e) => {
    if (e.metaKey && e.key === 'ArrowUp') {
    }
  })

  function keyboardNavigation(e) {
    switch (event.key) {
      case 'ArrowRight':
        setFocusToNextItem(document.activeElement);
        break;
      case 'ArrowLeft':
        setFocusToPreviousItem(document.activeElement);
        break;
      case 'ArrowUp':
        setFocusToParentItem(document.activeElement);
        break;
      case 'ArrowDown':
        setFocusToNextLayer(document.activeElement);
        break;
    }
  }

  function changeFocus(old, nw) {
    nw.tabIndex = 0;
    nw.focus();
    nw.setAttribute('aria-selected', 'true');

    old.tabIndex = -1;
    old.setAttribute('aria-selected', 'false');
  }

  function setFocusToNextItem(currentItem) {
    const id = currentItem.id;
    const parentId = id.slice(0, -2);
    const nextChildId = id.slice(0, -1) + (parseInt(id.slice(-1)) + 1).toString() // add 1 to last num
    if (document.getElementById(parentId) && document.getElementById(nextChildId)) {
      changeFocus(currentItem, document.getElementById(nextChildId));
    }
  }

  function setFocusToPreviousItem(currentItem) {
    const id = currentItem.id;
    const parentId = id.slice(0, -2);
    const prevChildId = id.slice(0, -1) + (parseInt(id.slice(-1)) - 1).toString() // add 1 to last num
    if (document.getElementById(parentId) && document.getElementById(prevChildId)) {
      changeFocus(currentItem, document.getElementById(prevChildId));
    }
  }

  function setFocusToNextLayer(currentItem) {
    const child = document.getElementById(currentItem.id + '-0');
    if (child) {
      changeFocus(currentItem, child);
    }
  }

  function setFocusToParentItem(currentItem) {
    const parent = document.getElementById(currentItem.id.slice(0, -2));
    if (parent) {
      changeFocus(currentItem, parent);
    }
  }

  /***
   *  Helper functions
   ***/

  // Hack to make screenreader re-read text when it is changed
  function srSpeak(text) {
    console.log(text);
    window.setTimeout(function () {
      const el = document.getElementById('speak');
      el.innerHTML = text;
    }, 100);
  }

  function titleCase(text) {
    return text.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
  }
</script>
